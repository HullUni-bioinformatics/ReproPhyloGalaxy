define(["libs/toastr","mvc/library/library-model","mvc/ui/ui-select"],function(d,c,b){var a=Backbone.View.extend({el:"#center",model:null,options:{},events:{"click .toolbtn_modify_dataset":"enableModification","click .toolbtn_cancel_modifications":"render","click .toolbtn-download-dataset":"downloadDataset","click .toolbtn-import-dataset":"importIntoHistory","click .toolbtn-share-dataset":"shareDataset","click .btn-copy-link-to-clipboard":"copyToClipboard","click .btn-make-private":"makeDatasetPrivate","click .btn-remove-restrictions":"removeDatasetRestrictions","click .toolbtn_save_permissions":"savePermissions","click .toolbtn_save_modifications":"comingSoon",},initialize:function(e){this.options=_.extend(this.options,e);if(this.options.id){this.fetchDataset()}},fetchDataset:function(e){this.options=_.extend(this.options,e);this.model=new c.Item({id:this.options.id});var f=this;this.model.fetch({success:function(){if(f.options.show_permissions){f.showPermissions()}else{if(f.options.show_version){f.fetchVersion()}else{f.render()}}},error:function(h,g){if(typeof g.responseJSON!=="undefined"){d.error(g.responseJSON.err_msg+" Click this to go back.","",{onclick:function(){Galaxy.libraries.library_router.back()}})}else{d.error("An error ocurred. Click this to go back.","",{onclick:function(){Galaxy.libraries.library_router.back()}})}}})},render:function(e){this.options=_.extend(this.options,e);$(".tooltip").remove();var f=this.templateDataset();this.$el.html(f({item:this.model}));$(".peek").html(this.model.get("peek"));$("#center [data-toggle]").tooltip()},fetchVersion:function(e){this.options=_.extend(this.options,e);that=this;if(!this.options.ldda_id){this.render();d.error("Library dataset version requested but no id provided.")}else{this.ldda=new c.Ldda({id:this.options.ldda_id});this.ldda.url=this.ldda.urlRoot+this.model.id+"/versions/"+this.ldda.id;this.ldda.fetch({success:function(){that.renderVersion()},error:function(g,f){if(typeof f.responseJSON!=="undefined"){d.error(f.responseJSON.err_msg)}else{d.error("An error ocurred.")}}})}},renderVersion:function(){$(".tooltip").remove();var e=this.templateVersion();this.$el.html(e({item:this.model,ldda:this.ldda}));$(".peek").html(this.ldda.get("peek"))},enableModification:function(){$(".tooltip").remove();var e=this.templateModifyDataset();this.$el.html(e({item:this.model}));$(".peek").html(this.model.get("peek"));$("#center [data-toggle]").tooltip()},downloadDataset:function(){var e="/api/libraries/datasets/download/uncompressed";var f={ld_ids:this.id};this.processDownload(e,f)},processDownload:function(f,g,h){if(f&&g){g=typeof g=="string"?g:$.param(g);var e="";$.each(g.split("&"),function(){var i=this.split("=");e+='<input type="hidden" name="'+i[0]+'" value="'+i[1]+'" />'});$('<form action="'+f+'" method="'+(h||"post")+'">'+e+"</form>").appendTo("body").submit().remove();d.info("Your download will begin soon.")}},importIntoHistory:function(){this.refreshUserHistoriesList(function(e){var f=e.templateBulkImportInModal();e.modal=Galaxy.modal;e.modal.show({closing_events:true,title:"Import into History",body:f({histories:e.histories.models}),buttons:{Import:function(){e.importCurrentIntoHistory()},Close:function(){Galaxy.modal.hide()}}})})},refreshUserHistoriesList:function(f){var e=this;this.histories=new c.GalaxyHistories();this.histories.fetch({success:function(g){if(g.length===0){d.warning("You have to create history first. Click this to do so.","",{onclick:function(){window.location="/"}})}else{f(e)}},error:function(h,g){if(typeof g.responseJSON!=="undefined"){d.error(g.responseJSON.err_msg)}else{d.error("An error ocurred.")}}})},importCurrentIntoHistory:function(){var e=$(this.modal.elMain).find("select[name=dataset_import_single] option:selected").val();var f=new c.HistoryItem();f.url=f.urlRoot+e+"/contents";jQuery.getJSON(galaxy_config.root+"history/set_as_current?id="+e);f.save({content:this.id,source:"library"},{success:function(){Galaxy.modal.hide();d.success("Dataset imported. Click this to start analysing it.","",{onclick:function(){window.location="/"}})},error:function(h,g){if(typeof g.responseJSON!=="undefined"){d.error("Dataset not imported. "+g.responseJSON.err_msg)}else{d.error("An error occured. Dataset not imported. Please try again.")}}})},shareDataset:function(){d.info("Feature coming soon.")},goBack:function(){Galaxy.libraries.library_router.back()},showPermissions:function(f){this.options=_.extend(this.options,f);$(".tooltip").remove();if(this.options.fetched_permissions!==undefined){if(this.options.fetched_permissions.access_dataset_roles.length===0){this.model.set({is_unrestricted:true})}else{this.model.set({is_unrestricted:false})}}var h=false;if(Galaxy.currUser){h=Galaxy.currUser.isAdmin()}var g=this.templateDatasetPermissions();this.$el.html(g({item:this.model,is_admin:h}));var e=this;if(this.options.fetched_permissions===undefined){$.get("/api/libraries/datasets/"+e.id+"/permissions?scope=current").done(function(i){e.prepareSelectBoxes({fetched_permissions:i,is_admin:h})}).fail(function(){d.error("An error occurred while attempting to fetch dataset permissions.")})}else{this.prepareSelectBoxes({is_admin:h})}$("#center [data-toggle]").tooltip();$("#center").css("overflow","auto")},prepareSelectBoxes:function(r){this.options=_.extend(this.options,r);var s=this.options.fetched_permissions;var k=this.options.is_admin;var q=this;var m=[];for(var h=0;h<s.access_dataset_roles.length;h++){m.push(s.access_dataset_roles[h]+":"+s.access_dataset_roles[h])}var f=[];for(var h=0;h<s.modify_item_roles.length;h++){f.push(s.modify_item_roles[h]+":"+s.modify_item_roles[h])}var g=[];for(var h=0;h<s.manage_dataset_roles.length;h++){g.push(s.manage_dataset_roles[h]+":"+s.manage_dataset_roles[h])}if(k){var o={minimumInputLength:0,css:"access_perm",multiple:true,placeholder:"Click to select a role",container:q.$el.find("#access_perm"),ajax:{url:"/api/libraries/datasets/"+q.id+"/permissions?scope=available",dataType:"json",quietMillis:100,data:function(i,t){return{q:i,page_limit:10,page:t}},results:function(u,t){var i=(t*10)<u.total;return{results:u.roles,more:i}}},formatResult:function j(i){return i.name+" type: "+i.type},formatSelection:function e(i){return i.name},initSelection:function(i,u){var t=[];$(i.val().split(",")).each(function(){var v=this.split(":");t.push({id:v[1],name:v[1]})});u(t)},initialData:m.join(","),dropdownCssClass:"bigdrop"};var l={minimumInputLength:0,css:"modify_perm",multiple:true,placeholder:"Click to select a role",container:q.$el.find("#modify_perm"),ajax:{url:"/api/libraries/datasets/"+q.id+"/permissions?scope=available",dataType:"json",quietMillis:100,data:function(i,t){return{q:i,page_limit:10,page:t}},results:function(u,t){var i=(t*10)<u.total;return{results:u.roles,more:i}}},formatResult:function j(i){return i.name+" type: "+i.type},formatSelection:function e(i){return i.name},initSelection:function(i,u){var t=[];$(i.val().split(",")).each(function(){var v=this.split(":");t.push({id:v[1],name:v[1]})});u(t)},initialData:f.join(","),dropdownCssClass:"bigdrop"};var p={minimumInputLength:0,css:"manage_perm",multiple:true,placeholder:"Click to select a role",container:q.$el.find("#manage_perm"),ajax:{url:"/api/libraries/datasets/"+q.id+"/permissions?scope=available",dataType:"json",quietMillis:100,data:function(i,t){return{q:i,page_limit:10,page:t}},results:function(u,t){var i=(t*10)<u.total;return{results:u.roles,more:i}}},formatResult:function j(i){return i.name+" type: "+i.type},formatSelection:function e(i){return i.name},initSelection:function(i,u){var t=[];$(i.val().split(",")).each(function(){var v=this.split(":");t.push({id:v[1],name:v[1]})});u(t)},initialData:g.join(","),dropdownCssClass:"bigdrop"};q.accessSelectObject=new b.View(o);q.modifySelectObject=new b.View(l);q.manageSelectObject=new b.View(p)}else{var n=q.templateAccessSelect();$.get("/api/libraries/datasets/"+q.id+"/permissions?scope=available",function(i){$(".access_perm").html(n({options:i.roles}));q.accessSelectObject=$("#access_select").select2()}).fail(function(){d.error("An error occurred while attempting to fetch dataset permissions.")})}},comingSoon:function(){d.warning("Feature coming soon.")},copyToClipboard:function(){var e=Backbone.history.location.href;if(e.lastIndexOf("/permissions")!==-1){e=e.substr(0,e.lastIndexOf("/permissions"))}window.prompt("Copy to clipboard: Ctrl+C, Enter",e)},makeDatasetPrivate:function(){var e=this;$.post("/api/libraries/datasets/"+e.id+"/permissions?action=make_private").done(function(f){e.model.set({is_unrestricted:false});e.showPermissions({fetched_permissions:f});d.success("The dataset is now private to you.")}).fail(function(){d.error("An error occurred while attempting to make dataset private.")})},removeDatasetRestrictions:function(){var e=this;$.post("/api/libraries/datasets/"+e.id+"/permissions?action=remove_restrictions").done(function(f){e.model.set({is_unrestricted:true});e.showPermissions({fetched_permissions:f});d.success("Access to this dataset is now unrestricted.")}).fail(function(){d.error("An error occurred while attempting to make dataset unrestricted.")})},savePermissions:function(e){var n=this;var k=this.accessSelectObject.$el.select2("data");var f=this.manageSelectObject.$el.select2("data");var m=this.modifySelectObject.$el.select2("data");var g=[];var j=[];var l=[];for(var h=k.length-1;h>=0;h--){g.push(k[h].id)}for(var h=f.length-1;h>=0;h--){j.push(f[h].id)}for(var h=m.length-1;h>=0;h--){l.push(m[h].id)}$.post("/api/libraries/datasets/"+n.id+"/permissions?action=set_permissions",{"access_ids[]":g,"manage_ids[]":j,"modify_ids[]":l,}).done(function(i){n.showPermissions({fetched_permissions:i});d.success("Permissions saved.")}).fail(function(){d.error("An error occurred while attempting to set dataset permissions.")})},templateDataset:function(){var e=[];e.push('<div class="library_style_container">');e.push('  <div id="library_toolbar">');e.push('   <button data-toggle="tooltip" data-placement="top" title="Download dataset" class="btn btn-default toolbtn-download-dataset primary-button" type="button"><span class="fa fa-download"></span> Download</span></button>');e.push('   <button data-toggle="tooltip" data-placement="top" title="Import dataset into history" class="btn btn-default toolbtn-import-dataset primary-button" type="button"><span class="fa fa-book"></span> to History</span></button>');e.push('   <% if (item.get("can_user_modify")) { %>');e.push('   <button data-toggle="tooltip" data-placement="top" title="Modify library item" class="btn btn-default toolbtn_modify_dataset primary-button" type="button"><span class="fa fa-pencil"></span> Modify</span></button>');e.push("   <% } %>");e.push('   <% if (item.get("can_user_manage")) { %>');e.push('   <a href="#folders/<%- item.get("folder_id") %>/datasets/<%- item.id %>/permissions"><button data-toggle="tooltip" data-placement="top" title="Manage permissions" class="btn btn-default toolbtn_change_permissions primary-button" type="button"><span class="fa fa-group"></span> Permissions</span></button></a>');e.push('   <button data-toggle="tooltip" data-placement="top" title="Share dataset" class="btn btn-default toolbtn-share-dataset primary-button" type="button"><span class="fa fa-share"></span> Share</span></button>');e.push("   <% } %>");e.push("  </div>");e.push('<ol class="breadcrumb">');e.push('   <li><a title="Return to the list of libraries" href="#">Libraries</a></li>');e.push('   <% _.each(item.get("full_path"), function(path_item) { %>');e.push("   <% if (path_item[0] != item.id) { %>");e.push('   <li><a title="Return to this folder" href="#/folders/<%- path_item[0] %>"><%- path_item[1] %></a> </li> ');e.push("<% } else { %>");e.push('   <li class="active"><span title="You are here"><%- path_item[1] %></span></li>');e.push("   <% } %>");e.push("   <% }); %>");e.push("</ol>");e.push('<% if (item.get("is_unrestricted")) { %>');e.push('  <div class="alert alert-info">');e.push("  This dataset is unrestricted so everybody can access it. Just share the URL of this page. ");e.push('  <button data-toggle="tooltip" data-placement="top" title="Copy to clipboard" class="btn btn-default btn-copy-link-to-clipboard primary-button" type="button"><span class="fa fa-clipboard"></span> To Clipboard</span></button> ');e.push("  </div>");e.push("<% } %>");e.push('<div class="dataset_table">');e.push('   <table class="grid table table-striped table-condensed">');e.push("       <tr>");e.push('           <th scope="row" id="id_row" data-id="<%= _.escape(item.get("ldda_id")) %>">Name</th>');e.push('           <td><%= _.escape(item.get("name")) %></td>');e.push("       </tr>");e.push('   <% if (item.get("file_ext")) { %>');e.push("       <tr>");e.push('           <th scope="row">Data type</th>');e.push('           <td><%= _.escape(item.get("file_ext")) %></td>');e.push("       </tr>");e.push("   <% } %>");e.push('   <% if (item.get("genome_build")) { %>');e.push("       <tr>");e.push('           <th scope="row">Genome build</th>');e.push('           <td><%= _.escape(item.get("genome_build")) %></td>');e.push("       </tr>");e.push("   <% } %>");e.push('   <% if (item.get("file_size")) { %>');e.push("       <tr>");e.push('           <th scope="row">Size</th>');e.push('           <td><%= _.escape(item.get("file_size")) %></td>');e.push("       </tr>");e.push("   <% } %>");e.push('   <% if (item.get("date_uploaded")) { %>');e.push("       <tr>");e.push('           <th scope="row">Date uploaded (UTC)</th>');e.push('           <td><%= _.escape(item.get("date_uploaded")) %></td>');e.push("       </tr>");e.push("   <% } %>");e.push('   <% if (item.get("uploaded_by")) { %>');e.push("       <tr>");e.push('           <th scope="row">Uploaded by</th>');e.push('           <td><%= _.escape(item.get("uploaded_by")) %></td>');e.push("       </tr>");e.push("   <% } %>");e.push('   <% if (item.get("metadata_data_lines")) { %>');e.push("       <tr>");e.push('           <th scope="row">Data Lines</th>');e.push('           <td scope="row"><%= _.escape(item.get("metadata_data_lines")) %></td>');e.push("       </tr>");e.push("   <% } %>");e.push('   <% if (item.get("metadata_comment_lines")) { %>');e.push("       <tr>");e.push('           <th scope="row">Comment Lines</th>');e.push('           <td scope="row"><%= _.escape(item.get("metadata_comment_lines")) %></td>');e.push("       </tr>");e.push("   <% } %>");e.push('   <% if (item.get("metadata_columns")) { %>');e.push("       <tr>");e.push('           <th scope="row">Number of Columns</th>');e.push('           <td scope="row"><%= _.escape(item.get("metadata_columns")) %></td>');e.push("       </tr>");e.push("   <% } %>");e.push('   <% if (item.get("metadata_column_types")) { %>');e.push("       <tr>");e.push('           <th scope="row">Column Types</th>');e.push('           <td scope="row"><%= _.escape(item.get("metadata_column_types")) %></td>');e.push("       </tr>");e.push("   <% } %>");e.push('   <% if (item.get("message")) { %>');e.push("       <tr>");e.push('           <th scope="row">Message</th>');e.push('           <td scope="row"><%= _.escape(item.get("message")) %></td>');e.push("       </tr>");e.push("   <% } %>");e.push('   <% if (item.get("misc_blurb")) { %>');e.push("       <tr>");e.push('           <th scope="row">Miscellaneous blurb</th>');e.push('           <td scope="row"><%= _.escape(item.get("misc_blurb")) %></td>');e.push("       </tr>");e.push("   <% } %>");e.push('   <% if (item.get("misc_info")) { %>');e.push("       <tr>");e.push('           <th scope="row">Miscellaneous information</th>');e.push('           <td scope="row"><%= _.escape(item.get("misc_info")) %></td>');e.push("       </tr>");e.push("   <% } %>");e.push("    </table>");e.push("    <div>");e.push('        <pre class="peek">');e.push("        </pre>");e.push("    </div>");e.push('   <% if (item.get("has_versions")) { %>');e.push("      <div>");e.push("      <h3>Expired versions:</h3>");e.push("      <ul>");e.push('      <% _.each(item.get("expired_versions"), function(version) { %>');e.push('        <li><a title="See details of this version" href="#folders/<%- item.get("folder_id") %>/datasets/<%- item.id %>/versions/<%- version[0] %>"><%- version[1] %></a></li>');e.push("      <% }) %>");e.push("      <ul>");e.push("      </div>");e.push("   <% } %>");e.push("</div>");e.push("</div>");return _.template(e.join(""))},templateVersion:function(){var e=[];e.push('<div class="library_style_container">');e.push('  <div id="library_toolbar">');e.push('   <a href="#folders/<%- item.get("folder_id") %>/datasets/<%- item.id %>"><button data-toggle="tooltip" data-placement="top" title="Go to latest dataset" class="btn btn-default primary-button" type="button"><span class="fa fa-caret-left fa-lg"></span> Latest dataset</span></button><a>');e.push("  </div>");e.push('<ol class="breadcrumb">');e.push('   <li><a title="Return to the list of libraries" href="#">Libraries</a></li>');e.push('   <% _.each(item.get("full_path"), function(path_item) { %>');e.push("   <% if (path_item[0] != item.id) { %>");e.push('   <li><a title="Return to this folder" href="#/folders/<%- path_item[0] %>"><%- path_item[1] %></a> </li> ');e.push("<% } else { %>");e.push('   <li class="active"><span title="You are here"><%- path_item[1] %></span></li>');e.push("   <% } %>");e.push("   <% }); %>");e.push("</ol>");e.push('  <div class="alert alert-warning">This is an expired version of the library dataset: <%= _.escape(item.get("name")) %></div>');e.push('<div class="dataset_table">');e.push('   <table class="grid table table-striped table-condensed">');e.push("       <tr>");e.push('           <th scope="row" id="id_row" data-id="<%= _.escape(ldda.id) %>">Name</th>');e.push('           <td><%= _.escape(ldda.get("name")) %></td>');e.push("       </tr>");e.push('   <% if (ldda.get("file_ext")) { %>');e.push("       <tr>");e.push('           <th scope="row">Data type</th>');e.push('           <td><%= _.escape(ldda.get("file_ext")) %></td>');e.push("       </tr>");e.push("   <% } %>");e.push('   <% if (ldda.get("genome_build")) { %>');e.push("       <tr>");e.push('           <th scope="row">Genome build</th>');e.push('           <td><%= _.escape(ldda.get("genome_build")) %></td>');e.push("       </tr>");e.push("   <% } %>");e.push('   <% if (ldda.get("file_size")) { %>');e.push("       <tr>");e.push('           <th scope="row">Size</th>');e.push('           <td><%= _.escape(ldda.get("file_size")) %></td>');e.push("       </tr>");e.push("   <% } %>");e.push('   <% if (ldda.get("date_uploaded")) { %>');e.push("       <tr>");e.push('           <th scope="row">Date uploaded (UTC)</th>');e.push('           <td><%= _.escape(ldda.get("date_uploaded")) %></td>');e.push("       </tr>");e.push("   <% } %>");e.push('   <% if (ldda.get("uploaded_by")) { %>');e.push("       <tr>");e.push('           <th scope="row">Uploaded by</th>');e.push('           <td><%= _.escape(ldda.get("uploaded_by")) %></td>');e.push("       </tr>");e.push("   <% } %>");e.push('   <% if (ldda.get("metadata_data_lines")) { %>');e.push("       <tr>");e.push('           <th scope="row">Data Lines</th>');e.push('           <td scope="row"><%= _.escape(ldda.get("metadata_data_lines")) %></td>');e.push("       </tr>");e.push("   <% } %>");e.push('   <% if (ldda.get("metadata_comment_lines")) { %>');e.push("       <tr>");e.push('           <th scope="row">Comment Lines</th>');e.push('           <td scope="row"><%= _.escape(ldda.get("metadata_comment_lines")) %></td>');e.push("       </tr>");e.push("   <% } %>");e.push('   <% if (ldda.get("metadata_columns")) { %>');e.push("       <tr>");e.push('           <th scope="row">Number of Columns</th>');e.push('           <td scope="row"><%= _.escape(ldda.get("metadata_columns")) %></td>');e.push("       </tr>");e.push("   <% } %>");e.push('   <% if (ldda.get("metadata_column_types")) { %>');e.push("       <tr>");e.push('           <th scope="row">Column Types</th>');e.push('           <td scope="row"><%= _.escape(ldda.get("metadata_column_types")) %></td>');e.push("       </tr>");e.push("   <% } %>");e.push('   <% if (ldda.get("message")) { %>');e.push("       <tr>");e.push('           <th scope="row">Message</th>');e.push('           <td scope="row"><%= _.escape(ldda.get("message")) %></td>');e.push("       </tr>");e.push("   <% } %>");e.push('   <% if (ldda.get("misc_blurb")) { %>');e.push("       <tr>");e.push('           <th scope="row">Miscellaneous blurb</th>');e.push('           <td scope="row"><%= _.escape(ldda.get("misc_blurb")) %></td>');e.push("       </tr>");e.push("   <% } %>");e.push('   <% if (ldda.get("misc_info")) { %>');e.push("       <tr>");e.push('           <th scope="row">Miscellaneous information</th>');e.push('           <td scope="row"><%= _.escape(ldda.get("misc_info")) %></td>');e.push("       </tr>");e.push("   <% } %>");e.push("    </table>");e.push("    <div>");e.push('        <pre class="peek">');e.push("        </pre>");e.push("    </div>");e.push("</div>");e.push("</div>");return _.template(e.join(""))},templateModifyDataset:function(){var e=[];e.push('<div class="library_style_container">');e.push('  <div id="library_toolbar">');e.push('   <button data-toggle="tooltip" data-placement="top" title="Cancel modifications" class="btn btn-default toolbtn_cancel_modifications primary-button" type="button"><span class="fa fa-times"></span> Cancel</span></button>');e.push('   <button data-toggle="tooltip" data-placement="top" title="Save modifications" class="btn btn-default toolbtn_save_modifications primary-button" type="button"><span class="fa fa-floppy-o"></span> Save</span></button>');e.push("  </div>");e.push('<ol class="breadcrumb">');e.push('   <li><a title="Return to the list of libraries" href="#">Libraries</a></li>');e.push('   <% _.each(item.get("full_path"), function(path_item) { %>');e.push("   <% if (path_item[0] != item.id) { %>");e.push('   <li><a title="Return to this folder" href="#/folders/<%- path_item[0] %>"><%- path_item[1] %></a> </li> ');e.push("<% } else { %>");e.push('   <li class="active"><span title="You are here"><%- path_item[1] %></span></li>');e.push("   <% } %>");e.push("   <% }); %>");e.push("</ol>");e.push('<div class="dataset_table">');e.push('<p>For more editing options please import the dataset to history and use "Edit attributes" on it.</p>');e.push('   <table class="grid table table-striped table-condensed">');e.push("       <tr>");e.push('           <th scope="row" id="id_row" data-id="<%= _.escape(item.get("ldda_id")) %>">Name</th>');e.push('           <td><input class="input_dataset_name form-control" type="text" placeholder="name" value="<%= _.escape(item.get("name")) %>"></td>');e.push("       </tr>");e.push("       <tr>");e.push('           <th scope="row">Data type</th>');e.push('           <td><%= _.escape(item.get("file_ext")) %></td>');e.push("       </tr>");e.push("       <tr>");e.push('           <th scope="row">Genome build</th>');e.push('           <td><%= _.escape(item.get("genome_build")) %></td>');e.push("       </tr>");e.push("       <tr>");e.push('           <th scope="row">Size</th>');e.push('           <td><%= _.escape(item.get("file_size")) %></td>');e.push("       </tr>");e.push("       <tr>");e.push('           <th scope="row">Date uploaded (UTC)</th>');e.push('           <td><%= _.escape(item.get("date_uploaded")) %></td>');e.push("       </tr>");e.push("       <tr>");e.push('           <th scope="row">Uploaded by</th>');e.push('           <td><%= _.escape(item.get("uploaded_by")) %></td>');e.push("       </tr>");e.push('           <tr scope="row">');e.push('           <th scope="row">Data Lines</th>');e.push('           <td scope="row"><%= _.escape(item.get("metadata_data_lines")) %></td>');e.push("       </tr>");e.push('       <th scope="row">Comment Lines</th>');e.push('           <% if (item.get("metadata_comment_lines") === "") { %>');e.push('               <td scope="row"><%= _.escape(item.get("metadata_comment_lines")) %></td>');e.push("           <% } else { %>");e.push('               <td scope="row">unknown</td>');e.push("           <% } %>");e.push("       </tr>");e.push("       <tr>");e.push('           <th scope="row">Number of Columns</th>');e.push('           <td scope="row"><%= _.escape(item.get("metadata_columns")) %></td>');e.push("       </tr>");e.push("       <tr>");e.push('           <th scope="row">Column Types</th>');e.push('           <td scope="row"><%= _.escape(item.get("metadata_column_types")) %></td>');e.push("       </tr>");e.push("       <tr>");e.push('           <th scope="row">Message</th>');e.push('           <td scope="row"><%= _.escape(item.get("message")) %></td>');e.push("       </tr>");e.push("       <tr>");e.push('           <th scope="row">Miscellaneous information</th>');e.push('           <td scope="row"><%= _.escape(item.get("misc_info")) %></td>');e.push("       </tr>");e.push("       <tr>");e.push('           <th scope="row">Miscellaneous blurb</th>');e.push('           <td scope="row"><%= _.escape(item.get("misc_blurb")) %></td>');e.push("       </tr>");e.push("   </table>");e.push("<div>");e.push('   <pre class="peek">');e.push("   </pre>");e.push("</div>");e.push("</div>");e.push("</div>");return _.template(e.join(""))},templateDatasetPermissions:function(){var e=[];e.push('<div class="library_style_container">');e.push('  <div id="library_toolbar">');e.push('   <a href="#folders/<%- item.get("folder_id") %>"><button data-toggle="tooltip" data-placement="top" title="Go back to containing folder" class="btn btn-default primary-button" type="button"><span class="fa fa-folder-open-o"></span> Containing Folder</span></button></a>');e.push('   <a href="#folders/<%- item.get("folder_id") %>/datasets/<%- item.id %>"><button data-toggle="tooltip" data-placement="top" title="Go back to dataset" class="btn btn-default primary-button" type="button"><span class="fa fa-file-o"></span> Dataset Details</span></button><a>');e.push("  </div>");e.push('<ol class="breadcrumb">');e.push('   <li><a title="Return to the list of libraries" href="#">Libraries</a></li>');e.push('   <% _.each(item.get("full_path"), function(path_item) { %>');e.push("   <% if (path_item[0] != item.id) { %>");e.push('   <li><a title="Return to this folder" href="#/folders/<%- path_item[0] %>"><%- path_item[1] %></a> </li> ');e.push("<% } else { %>");e.push('   <li class="active"><span title="You are here"><%- path_item[1] %></span></li>');e.push("   <% } %>");e.push("   <% }); %>");e.push("</ol>");e.push('<h1>Dataset: <%= _.escape(item.get("name")) %></h1>');e.push('<div class="alert alert-warning">');e.push("<% if (is_admin) { %>");e.push("You are logged in as an <strong>administrator</strong> therefore you can manage any dataset on this Galaxy instance. Please make sure you understand the consequences.");e.push("<% } else { %>");e.push("You can assign any number of roles to any of the following permission types. However please read carefully the implications of such actions.");e.push("<% } %>");e.push("</div>");e.push('<div class="dataset_table">');e.push("<h2>Library-related permissions</h2>");e.push("<h4>Roles that can modify the library item</h4>");e.push('<div id="modify_perm" class="modify_perm roles-selection"></div>');e.push('<div class="alert alert-info roles-selection">User with <strong>any</strong> of these roles can modify name, metadata, and other information about this library item.</div>');e.push("<hr/>");e.push("<h2>Dataset-related permissions</h2>");e.push('<div class="alert alert-warning">Changes made below will affect <strong>every</strong> library item that was created from this dataset and also every history this dataset is part of.</div>');e.push('<% if (!item.get("is_unrestricted")) { %>');e.push(" <p>You can remove all access restrictions on this dataset. ");e.push(' <button data-toggle="tooltip" data-placement="top" title="Everybody will be able to access the dataset." class="btn btn-default btn-remove-restrictions primary-button" type="button">');e.push(' <span class="fa fa-globe"> Remove restrictions</span>');e.push(" </button>");e.push(" </p>");e.push("<% } else { %>");e.push("  This dataset is unrestricted so everybody can access it. Just share the URL of this page.");e.push('  <button data-toggle="tooltip" data-placement="top" title="Copy to clipboard" class="btn btn-default btn-copy-link-to-clipboard primary-button" type="button"><span class="fa fa-clipboard"> To Clipboard</span></button> ');e.push("  <p>You can make this dataset private to you. ");e.push(' <button data-toggle="tooltip" data-placement="top" title="Only you will be able to access the dataset." class="btn btn-default btn-make-private primary-button" type="button"><span class="fa fa-key"> Make Private</span></button>');e.push(" </p>");e.push("<% } %>");e.push("<h4>Roles that can access the dataset</h4>");e.push('<div id="access_perm" class="access_perm roles-selection"></div>');e.push('<div class="alert alert-info roles-selection">User has to have <strong>all these roles</strong> in order to access this dataset. Users without access permission <strong>cannot</strong> have other permissions on this dataset. If there are no access roles set on the dataset it is considered <strong>unrestricted</strong>.</div>');e.push("<h4>Roles that can manage permissions on the dataset</h4>");e.push('<div id="manage_perm" class="manage_perm roles-selection"></div>');e.push('<div class="alert alert-info roles-selection">User with <strong>any</strong> of these roles can manage permissions of this dataset. If you remove yourself you will loose the ability manage this dataset unless you are an admin.</div>');e.push('<button data-toggle="tooltip" data-placement="top" title="Save modifications made on this page" class="btn btn-default toolbtn_save_permissions primary-button" type="button"><span class="fa fa-floppy-o"></span> Save</span></button>');e.push("</div>");e.push("</div>");return _.template(e.join(""))},templateBulkImportInModal:function(){var e=[];e.push('<span id="history_modal_combo_bulk" style="width:90%; margin-left: 1em; margin-right: 1em; ">');e.push("Select history: ");e.push('<select id="dataset_import_single" name="dataset_import_single" style="width:50%; margin-bottom: 1em; "> ');e.push("   <% _.each(histories, function(history) { %>");e.push('       <option value="<%= _.escape(history.get("id")) %>"><%= _.escape(history.get("name")) %></option>');e.push("   <% }); %>");e.push("</select>");e.push("</span>");return _.template(e.join(""))},templateAccessSelect:function(){var e=[];e.push('<select id="access_select" multiple>');e.push("   <% _.each(options, function(option) { %>");e.push('       <option value="<%- option.name %>"><%- option.name %></option>');e.push("   <% }); %>");e.push("</select>");return _.template(e.join(""))}});return{LibraryDatasetView:a}});