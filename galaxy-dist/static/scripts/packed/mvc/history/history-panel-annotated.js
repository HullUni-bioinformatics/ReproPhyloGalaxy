define(["mvc/history/history-panel","mvc/history/hda-li","mvc/history/hdca-li","mvc/base-mvc","utils/localization"],function(f,c,g,a,b){var e=f.HistoryPanel;var d=e.extend({className:e.prototype.className+" annotated-history-panel",_buildNewRender:function(){var h=e.prototype._buildNewRender.call(this);this.renderHistoryAnnotation(h);return h},renderHistoryAnnotation:function(i){var h=this.model.get("annotation");if(!h){return}i.find(".controls .annotation-display").text(h)},renderItems:function(i){i=i||this.$el;i.find(".list-items").replaceWith($("<table/>").addClass("list-items"));var h=e.prototype.renderItems.call(this,i);this.$list(i).prepend($("<tr/>").addClass("headers").append([$("<th/>").text(b("Dataset")),$("<th/>").text(b("Annotation"))]));return h},_attachItems:function(h){this.$list(h).append(this.views.map(function(j){var l=_.find(j.el.classList,function(m){return(/^state\-/).test(m)}),i=j.model.get("annotation")||"",k=$("<tr/>").append([$("<td/>").addClass("contents-container").append(j.$el).addClass(l?l.replace("-","-color-"):""),$("<td/>").addClass("additional-info").text(i)]);return k}));return this},events:_.extend(_.clone(e.prototype.events),{"click tr":function(h){$(h.currentTarget).find(".title-bar").click()},"click .icon-btn":function(h){h.stopPropagation()}}),toString:function(){return"AnnotatedHistoryPanel("+((this.model)?(this.model.get("name")):(""))+")"}});return{AnnotatedHistoryPanel:d}});