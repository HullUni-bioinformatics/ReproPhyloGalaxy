define(["mvc/base-mvc","utils/localization"],function(a,c){var b=Backbone.View.extend(a.LoggableMixin).extend({options:{warnAtPercent:85,errorAtPercent:100},initialize:function(d){this.log(this+".initialize:",d);_.extend(this.options,d);this.model.bind("change:quota_percent change:total_disk_usage",this.render,this)},update:function(d){this.log(this+" updating user data...",d);this.model.loadFromApi(this.model.get("id"),d);return this},isOverQuota:function(){return(this.model.get("quota_percent")!==null&&this.model.get("quota_percent")>=this.options.errorAtPercent)},_render_quota:function(){var d=this.model.toJSON(),f=d.quota_percent,e=$(this._templateQuotaMeter(d)),g=e.find(".progress-bar");if(this.isOverQuota()){g.attr("class","progress-bar progress-bar-danger");e.find(".quota-meter-text").css("color","white");this.trigger("quota:over",d)}else{if(f>=this.options.warnAtPercent){g.attr("class","progress-bar progress-bar-warning");this.trigger("quota:under quota:under:approaching",d)}else{g.attr("class","progress-bar progress-bar-success");this.trigger("quota:under quota:under:ok",d)}}return e},_render_usage:function(){var d=$(this._templateUsage(this.model.toJSON()));this.log(this+".rendering usage:",d);return d},render:function(){var d=null;this.log(this+".model.quota_percent:",this.model.get("quota_percent"));if((this.model.get("quota_percent")===null)||(this.model.get("quota_percent")===undefined)){d=this._render_usage()}else{d=this._render_quota()}this.$el.html(d);this.$el.find(".quota-meter-text").tooltip();return this},_templateQuotaMeter:function(d){return['<div id="quota-meter" class="quota-meter progress">','<div class="progress-bar" style="width: ',d.quota_percent,'%"></div>','<div class="quota-meter-text" style="top: 6px"',((d.nice_total_disk_usage)?(' title="Using '+d.nice_total_disk_usage+'">'):(">")),c("Using")," ",d.quota_percent,"%","</div>","</div>"].join("")},_templateUsage:function(d){return['<div id="quota-meter" class="quota-meter" style="background-color: transparent">','<div class="quota-meter-text" style="top: 6px; color: white">',((d.nice_total_disk_usage)?(c("Using ")+d.nice_total_disk_usage):("")),"</div>","</div>"].join("")},toString:function(){return"UserQuotaMeter("+this.model+")"}});return{UserQuotaMeter:b}});